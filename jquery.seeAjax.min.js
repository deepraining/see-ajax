if("undefined"==typeof jQuery)throw new Error("jquery.seeAjax requires jQuery");!function(e){function n(e){return e}function o(){var e=arguments[0];if("undefined"==typeof e||null===e)return{};if("object"!=typeof e)return e;var n,t=arguments[1],i=!0;t instanceof Array||(t=e,i=!1);var a,f={};for(a in t)n=i?t[a]:a,e.hasOwnProperty(n)&&(e[n]instanceof Array?f[n]=r(e[n]):"object"==typeof e[n]?f[n]=o(e[n]):f[n]=e[n]);return f}function r(e){if("undefined"==typeof e||null===e)return[];if(!(e instanceof Array))return[];var n=[];return e.map(function(e,r){"object"!=typeof e?n[r]=e:n[r]=o(e)}),n}function t(n,o){switch(o){case"int":return parseInt(n);case"float":return parseFloat(n);case"bool":return!!n;case"string":return n+"";default:return e[o]&&"function"==typeof e[o]?n=e[o](n):console.error(""+o+"：没有此内置操作，也无此全局函数"),n}}function i(e,n,i,a){var f,s=i.split("."),u=s.length,p=s[u-1],d=!!~p.indexOf("[]");if(2==u)f=d?void 0!=e[s[0]]&&e[s[0]]:void 0!=e[s[0]]&&e[s[0]][s[1]];else if(3==u)f=d?void 0!=e[s[0]]&&void 0!=e[s[0]][s[1]]&&e[s[0]][s[1]]:void 0!=e[s[0]]&&void 0!=e[s[0]][s[1]]&&e[s[0]][s[1]][s[2]];else{if(4!=u)return void console.error("点语法的解析最大只支持四级");f=d?void 0!=e[s[0]]&&void 0!=e[s[0]][s[1]]&&void 0!=e[s[0]][s[1]][s[2]]&&e[s[0]][s[1]][s[2]]:void 0!=e[s[0]]&&void 0!=e[s[0]][s[1]]&&void 0!=e[s[0]][s[1]][s[2]]&&e[s[0]][s[1]][s[2]][s[3]]}d?e[n]=c(f,p):"object"!=typeof f?e[n]=a?t(f,a):f:Array.isArray(f)?e[n]=r(f):e[n]=o(f)}function a(e,n,o,r,i){var a=e[o];e[n]=r?t(a,r):a,n!=o&&!i&&delete e[o]}function f(e,n,o){e[n]=c(e,o)}function c(e,o){var r,t=o.split("|"),i=t[0].slice(0,-2),a=t[1],f=t[2],c=t[3],s=t[4],u=!!s,p=e[i],d=0,y=0,l=0,v=0,m=[];if(!p||!Array.isArray(p))return void console.error("配置的键 "+i+" 不存在，或者值不是数组");if(u)switch(s){case"round":r=Math.round;break;case"floor":r=Math.floor;break;case"ceil":r=Math.ceil;break;case"abs":r=Math.abs;break;default:r=n,"concat"!=f&&console.error("子操作 "+s+" 不存在")}switch(f){case"sum":return p.map(function(e){d+=u?r(e[a]):e[a]}),d;case"average":return p.map(function(e){d+=u?r(e[a]):e[a]}),y=d/p.length;case"max":return p.map(function(e,n){var o=u?r(e[a]):e[a];n?o>l&&(l=o):l=o}),l;case"min":return p.map(function(e,n){var o=u?r(e[a]):e[a];n?o<v&&(v=o):v=o}),v;case"concat":return p.map(function(e){var n=u?e[a][s]():e[a];m.push(n)}),m.join(c?c:"");default:return void console.error("操作 "+f+" 不存在")}}function s(e,n,o){var r=n[o],t=!!~r.indexOf("^"),c=t?r.slice(0,-1):r,s=c.split("!"),u=s[0],p=s[1],d=!!~u.indexOf("."),y=!d&&!!~u.indexOf("[]");d?u.split(".").length>1?i(e,o,u,p):console.error("配置键名 "+c+" 有误"):y?f(e,o,u):a(e,o,u,p,t)}function u(e,n){n&&"object"==typeof n&&(Array.isArray(n)?e.map(function(e){!!n[0]&&"object"==typeof n[0]&&"object"==typeof e&&u(e,n[0])}):Object.keys(n).map(function(o){var r,t;if(r=n[o],"_"==o.slice(0,1)&&"undefined"==typeof e[o]){if(t=e[o.slice(1)],!t)return}else t=e[o];"object"==typeof r?Array.isArray(r)?t.map(function(e){r[0]&&"object"==typeof r[0]&&"object"==typeof e&&u(e,r[0])}):u(t,r):"string"==typeof r?s(e,n,o):console.error("无法解析key: \n"+("string"==typeof r?r:"object"==typeof r?JSON.stringify(r):""))}))}var p=function(e,n,t){var i=t?e instanceof Array?r(e):o(e):e;return n&&"object"==typeof n?u(i,n):console.error("传入的map格式有误，请传入对象或数组"),i};JSON.refactor=p}(this),function(e){var n=!1,o={},r={};r.getFormatData=function(e,n){var r=o.name[e],t=o.environment,i={};return"undefined"==typeof t&&(console.info("环境变量 config.environment 没有配置, 默认取值为0的环境"),t=0),!r&&console.error("config.url中无 "+e+" 对应的值"),Array.isArray(n)?n.map(function(e,n){i[o.requestKeys[r][t][n]]=e}):Object.keys(n).map(function(e){i[o.requestKeys[r][t][e]]=n[e]}),[o.url[r][t],i]},r.preHandle=function(e,n){var r=o.name[n],t=o.environment,i=!!o.preHandle&&!!o.preHandle.common&&o.preHandle.common,a=!!o.preHandle&&!!o.preHandle[r]&&o.preHandle[r];"undefined"==typeof t&&(console.info("环境变量 config.environment 没有配置, 默认取值为0的环境"),t=0),!!i&&("function"==typeof i?!t&&i(e):!!i[t]&&i[t](e)),!!a&&("function"==typeof a?!t&&a(e):!!a[t]&&a[t](e))},r.postHandle=function(e,n){var r=o.name[n],t=o.environment,i=!!o.postHandle&&!!o.postHandle.common&&o.postHandle.common,a=!!o.postHandle&&!!o.postHandle[r]&&o.postHandle[r],f=!!o.responseRefactor&&!!o.responseRefactor.common&&o.responseRefactor.common,c=!!o.responseRefactor&&!!o.responseRefactor[r]&&o.responseRefactor[r];"undefined"==typeof t&&(console.info("环境变量 config.environment 没有配置, 默认取值为0的环境"),t=0),!!f&&(Array.isArray(f)?!!f[t]&&JSON.refactor(e,f[t]):!t&&JSON.refactor(e,f)),!!c&&(Array.isArray(c)?!!c[t]&&JSON.refactor(e,c[t]):!t&&JSON.refactor(e,c)),!!i&&("function"==typeof i?!t&&i(e):!!i[t]&&i[t](e)),!!a&&("function"==typeof a?!t&&a(e):!!a[t]&&a[t](e))},r.send=function(n,o,t,i,a,f,c){var s=r.getFormatData(o,t);!a&&(a="json"),r.preHandle(s[1],o);var u=c||{};u.type=n,u.data=f?JSON.stringify(s[1]):s[1],u.dataType=a,u.success=function(e){r.postHandle(e,o),i(e)},e.ajax(s[0],u)},r.get=function(e,n,o,t,i){"object"==typeof t&&(i=t,t=void 0),r.send("get",e,n,o,t,!1,i)},r.beyondGet=function(e,n,o,t,i,a,f){"boolean"==typeof i?"object"==typeof a?(f=a,a=i,i=void 0):(a=i,i=void 0):"object"==typeof i&&(f=i,i=void 0,a=void 0),r.send(e,n,o,t,i,a,f)},r.post=function(e,n,o,t,i,a){r.beyondGet("post",e,n,o,t,i,a)},r.put=function(e,n,o,t,i,a){r.beyondGet("put",e,n,o,t,i,a)},r["delete"]=function(e,n,o,t,i,a){r.beyondGet("delete",e,n,o,t,i,a)},r.getEnv=function(){return o.environment?o.environment:0},r.config=function(r){n?e.extend(!0,o,r):(n=!0,o=r)},e.seeAjax=r}(jQuery);