if("undefined"==typeof jQuery)throw new Error("jquery.seeAjax requires jQuery");!function(e){function n(e){return e}function r(){var e=arguments[0];if("undefined"==typeof e||null===e)return{};if("object"!=typeof e)return e;var n,t=arguments[1],a=!0;t instanceof Array||(t=e,a=!1);var i,c={};for(i in t)n=a?t[i]:i,e.hasOwnProperty(n)&&(e[n]instanceof Array?c[n]=o(e[n]):"object"==typeof e[n]?c[n]=r(e[n]):c[n]=e[n]);return c}function o(e){if("undefined"==typeof e||null===e)return[];if(!(e instanceof Array))return[];var n=[];return e.map(function(e,o){"object"!=typeof e?n[o]=e:n[o]=r(e)}),n}function t(n,r){switch(r){case"int":return parseInt(n);case"float":return parseFloat(n);case"bool":return!!n;case"string":return n+"";default:return e[r]&&"function"==typeof e[r]?n=e[r](n):console.error(""+r+"：没有此内置操作，也无此全局函数"),n}}function a(e,n,a,i){var c,s=a.split("."),u=s.length,p=s[u-1],y=!!~p.indexOf("[]");if(2==u)c=y?void 0!=e[s[0]]&&e[s[0]]:void 0!=e[s[0]]&&e[s[0]][s[1]];else if(3==u)c=y?void 0!=e[s[0]]&&void 0!=e[s[0]][s[1]]&&e[s[0]][s[1]]:void 0!=e[s[0]]&&void 0!=e[s[0]][s[1]]&&e[s[0]][s[1]][s[2]];else{if(4!=u)return void console.error("点语法的解析最大只支持四级");c=y?void 0!=e[s[0]]&&void 0!=e[s[0]][s[1]]&&void 0!=e[s[0]][s[1]][s[2]]&&e[s[0]][s[1]][s[2]]:void 0!=e[s[0]]&&void 0!=e[s[0]][s[1]]&&void 0!=e[s[0]][s[1]][s[2]]&&e[s[0]][s[1]][s[2]][s[3]]}y?e[n]=f(c,p):"object"!=typeof c?e[n]=i?t(c,i):c:Array.isArray(c)?e[n]=o(c):e[n]=r(c)}function i(e,n,r,o,a){var i=e[r];e[n]=o?t(i,o):i,n!=r&&!a&&delete e[r]}function c(e,n,r){e[n]=f(e,r)}function f(e,r){var o,t=r.split("|"),a=t[0].slice(0,-2),i=t[1],c=t[2],f=t[3],s=t[4],u=!!s,p=e[a],y=0,d=0,l=0,v=0,m=[];if(!p||!Array.isArray(p))return void console.error("配置的键 "+a+" 不存在，或者值不是数组");if(u)switch(s){case"round":o=Math.round;break;case"floor":o=Math.floor;break;case"ceil":o=Math.ceil;break;case"abs":o=Math.abs;break;default:o=n,"concat"!=c&&console.error("子操作 "+s+" 不存在")}switch(c){case"sum":return p.map(function(e){y+=u?o(e[i]):e[i]}),y;case"average":return p.map(function(e){y+=u?o(e[i]):e[i]}),d=y/p.length;case"max":return p.map(function(e,n){var r=u?o(e[i]):e[i];n?r>l&&(l=r):l=r}),l;case"min":return p.map(function(e,n){var r=u?o(e[i]):e[i];n?r<v&&(v=r):v=r}),v;case"concat":return p.map(function(e){var n=u?e[i][s]():e[i];m.push(n)}),m.join(f?f:"");default:return void console.error("操作 "+c+" 不存在")}}function s(e,n,r){var o=n[r],t=!!~o.indexOf("^"),f=t?o.slice(0,-1):o,s=f.split("!"),u=s[0],p=s[1],y=!!~u.indexOf("."),d=!y&&!!~u.indexOf("[]");y?u.split(".").length>1?a(e,r,u,p):console.error("配置键名 "+f+" 有误"):d?c(e,r,u):i(e,r,u,p,t)}function u(e,n){return"object"!=typeof e||"object"!=typeof n?(console.error("target与map必须是对象或数组"),!1):!(Array.isArray(n)&&!Array.isArray(e)||!Array.isArray(n)&&Array.isArray(e))||(console.error("target类型与map类型不匹配"),console.error("target: "+JSON.stringify(e)),console.error("map: "+JSON.stringify(n)),!1)}function p(e,n){u(e,n)&&(Array.isArray(n)?e.map(function(e){p(e,n[0])}):Object.keys(n).map(function(r){var o,t;if(o=n[r],t="_"==r.slice(0,1)&&"undefined"==typeof e[r]?e[r.slice(1)]:e[r],"object"==typeof o){if(!u(t,o))return;Array.isArray(o)?t.map(function(e){u(e,o[0])&&p(e,o[0])}):p(t,o)}else"string"==typeof o?s(e,n,r):console.error("无法解析key: \n"+("string"==typeof o?o:"object"==typeof o?JSON.stringify(o):""))}))}var y=function(e,n,t){if("object"!=typeof e)return console.error("传入的source格式有误，请传入对象或数组"),a;if("object"!=typeof n)return console.error("传入的map格式有误，请传入对象或数组"),a;var a=t?Array.isArray(e)?o(e):r(e):e;return p(a,n),a};JSON.refactor=y}(this),function(e){var n=!1,r={},o={};o.getFormatData=function(e,n){var o=r.name[e],t=r.environment,a={};return"undefined"==typeof t&&(console.info("环境变量 config.environment 没有配置, 默认取值为0的环境"),t=0),!o&&console.error("config.url中无 "+e+" 对应的值"),Array.isArray(n)?n.map(function(e,n){a[r.requestKeys[o][t][n]]=e}):Object.keys(n).map(function(e){a[r.requestKeys[o][t][e]]=n[e]}),[r.url[o][t],a]},o.preHandle=function(e,n){var o=r.name[n],t=r.environment,a=!!r.preHandle&&!!r.preHandle.common&&r.preHandle.common,i=!!r.preHandle&&!!r.preHandle[o]&&r.preHandle[o];"undefined"==typeof t&&(console.info("环境变量 config.environment 没有配置, 默认取值为0的环境"),t=0),!!a&&("function"==typeof a?!t&&a(e):!!a[t]&&a[t](e)),!!i&&("function"==typeof i?!t&&i(e):!!i[t]&&i[t](e))},o.postHandle=function(e,n){var o=r.name[n],t=r.environment,a=!!r.postHandle&&!!r.postHandle.common&&r.postHandle.common,i=!!r.postHandle&&!!r.postHandle[o]&&r.postHandle[o],c=!!r.responseRefactor&&!!r.responseRefactor.common&&r.responseRefactor.common,f=!!r.responseRefactor&&!!r.responseRefactor[o]&&r.responseRefactor[o];"undefined"==typeof t&&(console.info("环境变量 config.environment 没有配置, 默认取值为0的环境"),t=0),!!c&&(Array.isArray(c)?!!c[t]&&JSON.refactor(e,c[t]):!t&&JSON.refactor(e,c)),!!f&&(Array.isArray(f)?!!f[t]&&JSON.refactor(e,f[t]):!t&&JSON.refactor(e,f)),!!a&&("function"==typeof a?!t&&a(e):!!a[t]&&a[t](e)),!!i&&("function"==typeof i?!t&&i(e):!!i[t]&&i[t](e))},o.send=function(n,r,t,a,i,c,f){var s=o.getFormatData(r,t);!i&&(i="json"),o.preHandle(s[1],r);var u=f||{};u.type=n,u.data=c?JSON.stringify(s[1]):s[1],u.dataType=i,u.success=function(e){o.postHandle(e,r),a(e)},e.ajax(s[0],u)},o.get=function(e,n,r,t,a){"object"==typeof t&&(a=t,t=void 0),o.send("get",e,n,r,t,!1,a)},o.beyondGet=function(e,n,r,t,a,i,c){"boolean"==typeof a?"object"==typeof i?(c=i,i=a,a=void 0):(i=a,a=void 0):"object"==typeof a&&(c=a,a=void 0,i=void 0),o.send(e,n,r,t,a,i,c)},o.post=function(e,n,r,t,a,i){o.beyondGet("post",e,n,r,t,a,i)},o.put=function(e,n,r,t,a,i){o.beyondGet("put",e,n,r,t,a,i)},o["delete"]=function(e,n,r,t,a,i){o.beyondGet("delete",e,n,r,t,a,i)},o.getEnv=function(){return r.environment?r.environment:0},o.config=function(o){n?e.extend(!0,r,o):(n=!0,r=o)},e.seeAjax=o}(jQuery);