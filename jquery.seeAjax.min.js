if("undefined"==typeof jQuery)throw new Error("jquery.seeAjax requires jQuery");!function(e){function r(e){return e}function o(){var e=arguments[0];if("undefined"==typeof e||null===e)return{};if("object"!=typeof e)return e;var r,t=arguments[1],i=!0;t instanceof Array||(t=e,i=!1);var a,f={};for(a in t)r=i?t[a]:a,e.hasOwnProperty(r)&&(e[r]instanceof Array?f[r]=n(e[r]):"object"==typeof e[r]?f[r]=o(e[r]):f[r]=e[r]);return f}function n(e){if("undefined"==typeof e||null===e)return[];if(!(e instanceof Array))return[];var r=[];return e.map(function(e,n){"object"!=typeof e?r[n]=e:r[n]=o(e)}),r}function t(r,o){switch(o){case"int":return parseInt(r);case"float":return parseFloat(r);case"bool":return!!r;case"string":return r+"";default:return e[o]&&"function"==typeof e[o]?r=e[o](r):console.error(""+o+"：没有此内置操作，也无此全局函数"),r}}function i(e,r,i,a){var f,s=i.split("."),u=s.length,p=s[u-1],y=!!~p.indexOf("[]");if(2==u)f=y?void 0!=e[s[0]]&&e[s[0]]:void 0!=e[s[0]]&&e[s[0]][s[1]];else if(3==u)f=y?void 0!=e[s[0]]&&void 0!=e[s[0]][s[1]]&&e[s[0]][s[1]]:void 0!=e[s[0]]&&void 0!=e[s[0]][s[1]]&&e[s[0]][s[1]][s[2]];else{if(4!=u)return void console.error("点语法的解析最大只支持四级");f=y?void 0!=e[s[0]]&&void 0!=e[s[0]][s[1]]&&void 0!=e[s[0]][s[1]][s[2]]&&e[s[0]][s[1]][s[2]]:void 0!=e[s[0]]&&void 0!=e[s[0]][s[1]]&&void 0!=e[s[0]][s[1]][s[2]]&&e[s[0]][s[1]][s[2]][s[3]]}y?e[r]=c(f,p):"object"!=typeof f?e[r]=a?t(f,a):f:Array.isArray(f)?e[r]=n(f):e[r]=o(f)}function a(e,r,o,n,i){var a=e[o];e[r]=n?t(a,n):a,r!=o&&!i&&delete e[o]}function f(e,r,o){e[r]=c(e,o)}function c(e,o){var n,t=o.split("|"),i=t[0].slice(0,-2),a=t[1],f=t[2],c=t[3],s=t[4],u=!!s,p=e[i],y=0,l=0,d=0,v=0,m=[];if(!p||!Array.isArray(p))return void console.error("配置的键 "+i+" 不存在，或者值不是数组");if(u)switch(s){case"round":n=Math.round;break;case"floor":n=Math.floor;break;case"ceil":n=Math.ceil;break;case"abs":n=Math.abs;break;default:n=r,"concat"!=f&&console.error("子操作 "+s+" 不存在")}switch(f){case"sum":return p.map(function(e){y+=u?n(e[a]):e[a]}),y;case"average":return p.map(function(e){y+=u?n(e[a]):e[a]}),l=y/p.length;case"max":return p.map(function(e,r){var o=u?n(e[a]):e[a];r?o>d&&(d=o):d=o}),d;case"min":return p.map(function(e,r){var o=u?n(e[a]):e[a];r?o<v&&(v=o):v=o}),v;case"concat":return p.map(function(e){var r=u?e[a][s]():e[a];m.push(r)}),m.join(c?c:"");default:return void console.error("操作 "+f+" 不存在")}}function s(e,r,o){var n=r[o],t=!!~n.indexOf("^"),c=t?n.slice(0,-1):n,s=c.split("!"),u=s[0],p=s[1],y=!!~u.indexOf("."),l=!y&&!!~u.indexOf("[]");y?u.split(".").length>1?i(e,o,u,p):console.error("配置键名 "+c+" 有误"):l?f(e,o,u):a(e,o,u,p,t)}function u(e,r){if("object"==typeof e&&"object"==typeof r)if(Array.isArray(r)){if(!Array.isArray(e))return console.error("target类型与map类型不匹配"),console.error("target: "+JSON.stringify(e)),void console.error("map: "+JSON.stringify(r));e.map(function(e){"object"==typeof r[0]&&"object"==typeof e&&u(e,r[0])})}else{if(Array.isArray(e))return console.error("target类型与map类型不匹配"),console.error("target: "+JSON.stringify(e)),void console.error("map: "+JSON.stringify(r));Object.keys(r).map(function(o){var n,t;if(n=r[o],t="_"==o.slice(0,1)&&"undefined"==typeof e[o]?e[o.slice(1)]:e[o])if("object"==typeof n)if(Array.isArray(n)){if(!Array.isArray(t))return console.error("target类型与map类型不匹配"),console.error("target: "+JSON.stringify(t)),void console.error("map: "+JSON.stringify(n));t.map(function(e){"object"==typeof n[0]&&"object"==typeof e&&u(e,n[0])})}else{if(Array.isArray(t))return console.error("target类型与map类型不匹配"),console.error("target: "+JSON.stringify(t)),void console.error("map: "+JSON.stringify(n));u(t,n)}else"string"==typeof n?s(e,r,o):console.error("无法解析key: \n"+("string"==typeof n?n:"object"==typeof n?JSON.stringify(n):""))})}}var p=function(e,r,t){if("object"!=typeof e)return console.error("传入的source格式有误，请传入对象或数组"),i;if("object"!=typeof r)return console.error("传入的map格式有误，请传入对象或数组"),i;var i=t?Array.isArray(e)?n(e):o(e):e;return u(i,r),i};JSON.refactor=p}(this),function(e){var r=!1,o={},n={};n.getFormatData=function(e,r){var n=o.name[e],t=o.environment,i={};return"undefined"==typeof t&&(console.info("环境变量 config.environment 没有配置, 默认取值为0的环境"),t=0),!n&&console.error("config.url中无 "+e+" 对应的值"),Array.isArray(r)?r.map(function(e,r){i[o.requestKeys[n][t][r]]=e}):Object.keys(r).map(function(e){i[o.requestKeys[n][t][e]]=r[e]}),[o.url[n][t],i]},n.preHandle=function(e,r){var n=o.name[r],t=o.environment,i=!!o.preHandle&&!!o.preHandle.common&&o.preHandle.common,a=!!o.preHandle&&!!o.preHandle[n]&&o.preHandle[n];"undefined"==typeof t&&(console.info("环境变量 config.environment 没有配置, 默认取值为0的环境"),t=0),!!i&&("function"==typeof i?!t&&i(e):!!i[t]&&i[t](e)),!!a&&("function"==typeof a?!t&&a(e):!!a[t]&&a[t](e))},n.postHandle=function(e,r){var n=o.name[r],t=o.environment,i=!!o.postHandle&&!!o.postHandle.common&&o.postHandle.common,a=!!o.postHandle&&!!o.postHandle[n]&&o.postHandle[n],f=!!o.responseRefactor&&!!o.responseRefactor.common&&o.responseRefactor.common,c=!!o.responseRefactor&&!!o.responseRefactor[n]&&o.responseRefactor[n];"undefined"==typeof t&&(console.info("环境变量 config.environment 没有配置, 默认取值为0的环境"),t=0),!!f&&(Array.isArray(f)?!!f[t]&&JSON.refactor(e,f[t]):!t&&JSON.refactor(e,f)),!!c&&(Array.isArray(c)?!!c[t]&&JSON.refactor(e,c[t]):!t&&JSON.refactor(e,c)),!!i&&("function"==typeof i?!t&&i(e):!!i[t]&&i[t](e)),!!a&&("function"==typeof a?!t&&a(e):!!a[t]&&a[t](e))},n.send=function(r,o,t,i,a,f,c){var s=n.getFormatData(o,t);!a&&(a="json"),n.preHandle(s[1],o);var u=c||{};u.type=r,u.data=f?JSON.stringify(s[1]):s[1],u.dataType=a,u.success=function(e){n.postHandle(e,o),i(e)},e.ajax(s[0],u)},n.get=function(e,r,o,t,i){"object"==typeof t&&(i=t,t=void 0),n.send("get",e,r,o,t,!1,i)},n.beyondGet=function(e,r,o,t,i,a,f){"boolean"==typeof i?"object"==typeof a?(f=a,a=i,i=void 0):(a=i,i=void 0):"object"==typeof i&&(f=i,i=void 0,a=void 0),n.send(e,r,o,t,i,a,f)},n.post=function(e,r,o,t,i,a){n.beyondGet("post",e,r,o,t,i,a)},n.put=function(e,r,o,t,i,a){n.beyondGet("put",e,r,o,t,i,a)},n["delete"]=function(e,r,o,t,i,a){n.beyondGet("delete",e,r,o,t,i,a)},n.getEnv=function(){return o.environment?o.environment:0},n.config=function(n){r?e.extend(!0,o,n):(r=!0,o=n)},e.seeAjax=n}(jQuery);