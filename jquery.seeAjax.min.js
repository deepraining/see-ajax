if("undefined"==typeof jQuery)throw new Error("jquery.seeAjax requires jQuery");!function(e){function n(e){return e}function o(){var e=arguments[0];if("undefined"==typeof e||null===e)return{};if("object"!=typeof e)return e;var n,r=arguments[1],f=!0;r instanceof Array||(r=e,f=!1);var a,i={};for(a in r)n=f?r[a]:a,e.hasOwnProperty(n)&&(e[n]instanceof Array?i[n]=t(e[n]):"object"==typeof e[n]?i[n]=o(e[n]):i[n]=e[n]);return i}function t(e){if("undefined"==typeof e||null===e)return[];if(!(e instanceof Array))return[];var n=[];return e.map(function(e,t){"object"!=typeof e?n[t]=e:n[t]=o(e)}),n}function r(e,n){switch(n){case"int":return parseInt(e);case"float":return parseFloat(e);case"bool":return!!e;case"string":return e+"";default:return window[n]&&"function"==typeof window[n]?e=window[n](e):console.error(""+n+"：没有此内置操作，也无此全局函数"),e}}function f(e,n,f,a){var i,u=f.split("."),s=u.length,p=u[s-1],d=!!~p.indexOf("[]");if(2==s)i=d?"undefined"!=typeof e[u[0]]&&e[u[0]]:"undefined"!=typeof e[u[0]]&&e[u[0]][u[1]];else if(3==s)i=d?"undefined"!=typeof e[u[0]]&&"undefined"!=typeof e[u[0]][u[1]]&&e[u[0]][u[1]]:"undefined"!=typeof e[u[0]]&&"undefined"!=typeof e[u[0]][u[1]]&&e[u[0]][u[1]][u[2]];else{if(4!=s)return void console.error("点语法的解析最大只支持四级");i=d?"undefined"!=typeof e[u[0]]&&"undefined"!=typeof e[u[0]][u[1]]&&"undefined"!=typeof e[u[0]][u[1]][u[2]]&&e[u[0]][u[1]][u[2]]:"undefined"!=typeof e[u[0]]&&"undefined"!=typeof e[u[0]][u[1]]&&"undefined"!=typeof e[u[0]][u[1]][u[2]]&&e[u[0]][u[1]][u[2]][u[3]]}d?e[n]=c(i,p):"object"!=typeof i?e[n]=a?r(i,a):i:Array.isArray(i)?e[n]=t(i):e[n]=o(i)}function a(e,n,o,t,f){var a=e[o];e[n]=t?r(a,t):a,n!=o&&!f&&delete e[o]}function i(e,n,o){e[n]=c(e,o)}function c(e,o){var t,r=o.split("|"),f=r[0].slice(0,-2),a=r[1],i=r[2],c=r[3],u=r[4],s=!!u,p=e[f],d=0,y=0,l=0,m=0,v=[];if(!p||!Array.isArray(p))return void console.error("配置的键 "+f+" 不存在，或者值不是数组");if(s)switch(u){case"round":t=Math.round;break;case"floor":t=Math.floor;break;case"ceil":t=Math.ceil;break;case"abs":t=Math.abs;break;default:t=n,"concat"!=i&&console.error("子操作 "+u+" 不存在")}switch(i){case"sum":return p.map(function(e){d+=s?t(e[a]):e[a]}),d;case"average":return p.map(function(e){d+=s?t(e[a]):e[a]}),y=d/p.length;case"max":return p.map(function(e,n){var o=s?t(e[a]):e[a];n?o>l&&(l=o):l=o}),l;case"min":return p.map(function(e,n){var o=s?t(e[a]):e[a];n?o<m&&(m=o):m=o}),m;case"concat":return p.map(function(e){var n=s?e[a][u]():e[a];v.push(n)}),v.join(c?c:"");default:return void console.error("操作 "+i+" 不存在")}}function u(e,n,o){var t=n[o],r=!!~t.indexOf("^"),c=r?t.slice(0,-1):t,u=c.split("!"),s=u[0],p=u[1],d=!!~s.indexOf("."),y=!d&&!!~s.indexOf("[]");d?s.split(".").length>1?f(e,o,s,p):console.error("配置键名 "+c+" 有误"):y?i(e,o,s):a(e,o,s,p,r)}function s(e,n){n&&"object"==typeof n&&(Array.isArray(n)?e.map(function(e){!!n[0]&&"object"==typeof n[0]&&"object"==typeof e&&s(e,n[0])}):Object.keys(n).map(function(o){var t,r;t=n[o],r="_"==o.slice(0,1)&&"undefined"==typeof e[o]?e[o.slice(1)]:e[o],"object"==typeof t&&r?Array.isArray(t)?r.map(function(e){t[0]&&"object"==typeof t[0]&&"object"==typeof e&&s(e,t[0])}):s(r,t):"string"==typeof t?u(e,n,o):console.error("无法解析key: \n"+("string"==typeof t?t:"object"==typeof t?JSON.stringify(t):""))}))}var p=function(e,n,r){var f=r?e instanceof Array?t(e):o(e):e;return n&&"object"==typeof n?s(f,n):console.error("传入的map格式有误，请传入对象或数组"),f};e.JSON.refactor=p}("undefined"!=typeof window?window:this),function(e){var n=!1,o={},t={};t.getFormatData=function(e,n){var t=o.name[e],r=o.environment,f={};return"undefined"==typeof r&&(console.info("环境变量 config.environment 没有配置, 默认取值为0的环境"),r=0),!t&&console.error("config.url中无 "+e+" 对应的值"),Array.isArray(n)?n.map(function(e,n){f[o.requestKeys[t][r][n]]=e}):Object.keys(n).map(function(e){f[o.requestKeys[t][r][e]]=n[e]}),[o.url[t][r],f]},t.preHandle=function(e,n){var t=o.name[n],r=o.environment,f=!!o.preHandle&&!!o.preHandle.common&&o.preHandle.common,a=!!o.preHandle&&!!o.preHandle[t]&&o.preHandle[t];"undefined"==typeof r&&(console.log("环境变量 config.environment 没有配置, 默认取值为0的环境"),r=0),!!f&&("function"==typeof f?!r&&f(e):!!f[r]&&f[r](e)),!!a&&("function"==typeof a?!r&&a(e):!!a[r]&&a[r](e))},t.postHandle=function(e,n){var t=o.name[n],r=o.environment,f=!!o.postHandle&&!!o.postHandle.common&&o.postHandle.common,a=!!o.postHandle&&!!o.postHandle[t]&&o.postHandle[t],i=!!o.responseRefactor&&!!o.responseRefactor.common&&o.responseRefactor.common,c=!!o.responseRefactor&&!!o.responseRefactor[t]&&o.responseRefactor[t];"undefined"==typeof r&&(console.log("环境变量 config.environment 没有配置, 默认取值为0的环境"),r=0),!!i&&(Array.isArray(i)?!!i[r]&&JSON.refactor(e,i[r]):!r&&JSON.refactor(e,i)),!!c&&(Array.isArray(c)?!!c[r]&&JSON.refactor(e,c[r]):!r&&JSON.refactor(e,c)),!!f&&("function"==typeof f?!r&&f(e):!!f[r]&&f[r](e)),!!a&&("function"==typeof a?!r&&a(e):!!a[r]&&a[r](e))},t.send=function(n,o,r,f,a,i){var c=t.getFormatData(o,r);!a&&(a="json"),t.preHandle(c[1],o),e.ajax(c[0],{type:n,data:i?JSON.stringify(c[1]):c[1],dataType:a,success:function(e){t.postHandle(e,o),f(e)}})},t.get=function(e,n,o,r){t.send("get",e,n,o,r,!1)},t.beyondGet=function(e,n,o,r,f,a){5==arguments.length&&"boolean"==typeof f&&(a=f,f="json"),t.send(e,n,o,r,f,a)},t.post=function(e,n,o,r,f){t.beyondGet("post",e,n,o,r,f)},t.put=function(e,n,o,r,f){t.beyondGet("put",e,n,o,r,f)},t["delete"]=function(e,n,o,r,f){t.beyondGet("delete",e,n,o,r,f)},t.getEnv=function(){return o.environment?o.environment:0},t.config=function(t){n?e.extend(!0,o,t):(n=!0,o=t)},e.seeAjax=t}(jQuery);