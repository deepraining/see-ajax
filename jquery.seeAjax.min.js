if("undefined"==typeof jQuery)throw new Error("jquery.seeAjax requires jQuery");!function(e){function n(e){return e}function o(){var e=arguments[0];if("undefined"==typeof e||null===e)return{};if("object"!=typeof e)return e;var n,t=arguments[1],f=!0;t instanceof Array||(t=e,f=!1);var a,i={};for(a in t)n=f?t[a]:a,e.hasOwnProperty(n)&&(e[n]instanceof Array?i[n]=r(e[n]):"object"==typeof e[n]?i[n]=o(e[n]):i[n]=e[n]);return i}function r(e){if("undefined"==typeof e||null===e)return[];if(!(e instanceof Array))return[];var n=[];return e.map(function(e,r){"object"!=typeof e?n[r]=e:n[r]=o(e)}),n}function t(e,n){switch(n){case"int":return parseInt(e);case"float":return parseFloat(e);case"bool":return!!e;case"string":return e+"";default:return window[n]&&"function"==typeof window[n]?e=window[n](e):console.error(""+n+"：没有此内置操作，也无此全局函数"),e}}function f(e,n,f,a){var i,u=f.split("."),s=u.length,p=u[s-1],d=!!~p.indexOf("[]");if(2==s)i=d?"undefined"!=typeof e[u[0]]&&e[u[0]]:"undefined"!=typeof e[u[0]]&&e[u[0]][u[1]];else if(3==s)i=d?"undefined"!=typeof e[u[0]]&&"undefined"!=typeof e[u[0]][u[1]]&&e[u[0]][u[1]]:"undefined"!=typeof e[u[0]]&&"undefined"!=typeof e[u[0]][u[1]]&&e[u[0]][u[1]][u[2]];else{if(4!=s)return void console.error("点语法的解析最大只支持四级");i=d?"undefined"!=typeof e[u[0]]&&"undefined"!=typeof e[u[0]][u[1]]&&"undefined"!=typeof e[u[0]][u[1]][u[2]]&&e[u[0]][u[1]][u[2]]:"undefined"!=typeof e[u[0]]&&"undefined"!=typeof e[u[0]][u[1]]&&"undefined"!=typeof e[u[0]][u[1]][u[2]]&&e[u[0]][u[1]][u[2]][u[3]]}d?e[n]=c(i,p):"object"!=typeof i?e[n]=a?t(i,a):i:Array.isArray(i)?e[n]=r(i):e[n]=o(i)}function a(e,n,o,r,f){var a=e[o];e[n]=r?t(a,r):a,n!=o&&!f&&delete e[o]}function i(e,n,o){e[n]=c(e,o)}function c(e,o){var r,t=o.split("|"),f=t[0].slice(0,-2),a=t[1],i=t[2],c=t[3],u=t[4],s=!!u,p=e[f],d=0,y=0,l=0,m=0,v=[];if(!p||!Array.isArray(p))return void console.error("配置的键 "+f+" 不存在，或者值不是数组");if(s)switch(u){case"round":r=Math.round;break;case"floor":r=Math.floor;break;case"ceil":r=Math.ceil;break;case"abs":r=Math.abs;break;default:r=n,"concat"!=i&&console.error("子操作 "+u+" 不存在")}switch(i){case"sum":return p.map(function(e){d+=s?r(e[a]):e[a]}),d;case"average":return p.map(function(e){d+=s?r(e[a]):e[a]}),y=d/p.length;case"max":return p.map(function(e,n){var o=s?r(e[a]):e[a];n?o>l&&(l=o):l=o}),l;case"min":return p.map(function(e,n){var o=s?r(e[a]):e[a];n?o<m&&(m=o):m=o}),m;case"concat":return p.map(function(e){var n=s?e[a][u]():e[a];v.push(n)}),v.join(c?c:"");default:return void console.error("操作 "+i+" 不存在")}}function u(e,n,o){var r=n[o],t=!!~r.indexOf("^"),c=t?r.slice(0,-1):r,u=c.split("!"),s=u[0],p=u[1],d=!!~s.indexOf("."),y=!d&&!!~s.indexOf("[]");d?s.split(".").length>1?f(e,o,s,p):console.error("配置键名 "+c+" 有误"):y?i(e,o,s):a(e,o,s,p,t)}function s(e,n){n&&"object"==typeof n&&(Array.isArray(n)?e.map(function(e){!!n[0]&&"object"==typeof n[0]&&"object"==typeof e&&s(e,n[0])}):Object.keys(n).map(function(o){var r,t;r=n[o],t="_"==o.slice(0,1)&&"undefined"==typeof e[o]?e[o.slice(1)]:e[o],"object"==typeof r&&t?Array.isArray(r)?t.map(function(e){r[0]&&"object"==typeof r[0]&&"object"==typeof e&&s(e,r[0])}):s(t,r):"string"==typeof r?u(e,n,o):console.error("无法解析key: \n"+("string"==typeof r?r:"object"==typeof r?JSON.stringify(r):""))}))}var p=function(e,n,t){var f=t?e instanceof Array?r(e):o(e):e;return n&&"object"==typeof n?s(f,n):console.error("传入的map格式有误，请传入对象或数组"),f};e.JSON.refactor=p}("undefined"!=typeof window?window:this),function(e){var n=!1,o={},r={};r.getFormatData=function(e,n){var r=o.name[e],t=o.environment,f={};return"undefined"==typeof t&&(console.error("环境变量 config.environment 没有配置, 默认取值为0的环境"),t=0),!r&&console.error("config.url中无 "+e+" 对应的值"),Array.isArray(n)?n.map(function(e,n){f[o.requestKeys[r][t][n]]=e}):Object.keys(n).map(function(e){f[o.requestKeys[r][t][e]]=n[e]}),[o.url[r][t],f]},r.preHandle=function(e,n){var r=o.name[n],t=o.environment,f=!!o.preHandle&&!!o.preHandle.common&&o.preHandle.common,a=!!o.preHandle&&!!o.preHandle[r]&&o.preHandle[r];"undefined"==typeof t&&(console.error("环境变量 config.environment 没有配置, 默认取值为0的环境"),t=0),!!f&&("function"==typeof f?!t&&f(e):!!f[t]&&f[t](e)),!!a&&("function"==typeof a?!t&&a(e):!!a[t]&&a[t](e))},r.postHandle=function(e,n){var r=o.name[n],t=o.environment,f=!!o.postHandle&&!!o.postHandle.common&&o.postHandle.common,a=!!o.postHandle&&!!o.postHandle[r]&&o.postHandle[r],i=!!o.responseRefactor&&!!o.responseRefactor.common&&o.responseRefactor.common,c=!!o.responseRefactor&&!!o.responseRefactor[r]&&o.responseRefactor[r];"undefined"==typeof t&&(console.error("环境变量 config.environment 没有配置, 默认取值为0的环境"),t=0),!!i&&(Array.isArray(i)?!!i[t]&&JSON.refactor(e,i[t]):!t&&JSON.refactor(e,i)),!!c&&(Array.isArray(c)?!!c[t]&&JSON.refactor(e,c[t]):!t&&JSON.refactor(e,c)),!!f&&("function"==typeof f?!t&&f(e):!!f[t]&&f[t](e)),!!a&&("function"==typeof a?!t&&a(e):!!a[t]&&a[t](e))},r.send=function(n,o,t,f,a,i){var c=r.getFormatData(o,t);!a&&(a="json"),r.preHandle(c[1],o),e.ajax(c[0],{type:n,data:i?JSON.stringify(c[1]):c[1],dataType:a,success:function(e){r.postHandle(e,o),f(e)}})},r.get=function(e,n,o,t){r.send("get",e,n,o,t,!1)},r.beyondGet=function(e,n,o,t,f,a){5==arguments.length&&"boolean"==typeof f&&(a=f,f="json"),r.send(e,n,o,t,f,a)},r.post=function(e,n,o,t,f){r.beyondGet("post",e,n,o,t,f)},r.put=function(e,n,o,t,f){r.beyondGet("put",e,n,o,t,f)},r["delete"]=function(e,n,o,t,f){r.beyondGet("delete",e,n,o,t,f)},r.config=function(r){n?e.extend(!0,o,r):(n=!0,o=r)},e.seeAjax=r}(jQuery);